/* ConsoleSink_WindowsAPI.h
 * 
 *  Author          : Alexander J. Yee
 *  Date Created    : 08/05/2024
 *  Last Modified   : 08/05/2024
 * 
 */

#pragma once
#ifndef ymp_Console_ConsoleSink_WindowsAPI_H
#define ymp_Console_ConsoleSink_WindowsAPI_H
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  Dependencies
#include "PublicLibs/ConsoleIO/OutputStream.h"
namespace ymp{
namespace Console{
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
class ConsoleSink_WindowsAPI : public ConsoleSink{
public:
    ConsoleSink_WindowsAPI(StatusPrintMode mode, bool enable_colors, upL_t line_length);

    virtual std::unique_ptr<ConsoleSink> clone(
        StatusPrintMode mode,
        bool enable_colors,
        upL_t line_length
    ) const override;

    virtual void operator+=(const ColorString& str) override;
    virtual void clear_temp_lines() override;

private:
    void internal_WriteFile(const std::string& str);
    void internal_WriteConsole(const std::wstring& str);
    virtual void prepare_overwrite(upL_t lines_to_replace_with) override;
    virtual void internal_print(const ColorString& str) override;

private:
    void* m_handle;
    bool m_console;
    const std::string m_blank_line;
};
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
}
}
#endif
